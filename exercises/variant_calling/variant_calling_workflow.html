<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Per Unneberg">
<meta name="description" content="Perform variant calling and genotyping. Introduction to workflow manager systems.">
<title>Variant calling workflow – Population Genomics in Practice 2025</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../assets/logos/nbislogo-green.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-e0fa960b084fe2c1b9e2a0a843ce9846.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c99def4582b0a787bea15946fe8e6d6f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/all.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-1.2.0/latex-fontsize.css" rel="stylesheet"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg " data-bs-theme="dark"><div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/logos/nbislogo-green.svg" alt="" class="navbar-logo"></a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Population Genomics in Practice 2025</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
<li class="nav-item">
    <a class="nav-link active" href="../../slides/index.html" aria-current="page"> 
<span class="menu-text">Slides</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../exercises/index.html"> 
<span class="menu-text">Exercises</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../recipes/index.html"> 
<span class="menu-text">Code recipes</span></a>
  </li>  
</ul>
</div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../exercises/index.html">Exercises</a></li><li class="breadcrumb-item"><a href="../../exercises/variant_calling/index.html">Variant calling</a></li><li class="breadcrumb-item"><a href="../../exercises/variant_calling/variant_calling_workflow.html">Variant calling workflow</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Slides</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Introduction</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/pgip/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Population genomics in practice</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Population genetics foundations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/foundations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/foundations/data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data and definitions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/foundations/alleles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Alleles and genealogies</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/foundations/linkage.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linkage disequilibrium</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/foundations/wrightfisher.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">The Wright-Fisher model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/foundations/diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Genetic diversity</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">Variant calling</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_calling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_calling/dna_sequencing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">DNA sequencing data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_calling/read_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Read mapping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_calling/variant_calling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variant calling and genotyping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_calling/reproducibility.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variant calling workflows</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Variant filtering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_filtering/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_filtering/variant_filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variant filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/variant_filtering/depth_filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Depth filtering</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Genetic diversity</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/genetic_diversity/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/genetic_diversity/diversity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Genetic diversity</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false">
 <span class="menu-text">Population structure</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/population_structure/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/population_structure/pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Principal component analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../slides/population_structure/admixture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Admixture</span></a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Exercises</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false">
 <span class="menu-text">Data</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/compute_environment/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Compute environment</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/datasets/monkeyflowers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Monkeyflowers dataset</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Variant calling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth2 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_calling/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_calling/introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variant calling introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_calling/data_qc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Data quality control</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_calling/read_mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Read mapping and duplicate removal</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_calling/variant_calling_workflow.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Variant calling workflow</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false">
 <span class="menu-text">Variant filtering</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_filtering/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_filtering/basic_filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Basic variant filtering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/variant_filtering/depth_filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Depth filtering on invariant sites</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false">
 <span class="menu-text">Recombination and linkage</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/recombination_linkage/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/recombination_linkage/ld_decay.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linkage disequilibrium decay</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false">
 <span class="menu-text">Genetic diversity</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/genetic_diversity/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/genetic_diversity/landscape.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Genetic diversity landscapes</span></a>
  </div>
</li>
      </ul>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false">
 <span class="menu-text">Population structure</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-14" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-14" class="collapse list-unstyled sidebar-section depth2 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/population_structure/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Listing</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/population_structure/pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Principal component analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/population_structure/admixture.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Admixture</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../exercises/population_structure/dstats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">D-statistics</span></a>
  </div>
</li>
      </ul>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="true">
 <span class="menu-text">Code recipes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-15" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-15" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../recipes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Code recipes</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">On this page</h2>
   
  <ul>
<li>
<a href="#workflow-managers" id="toc-workflow-managers" class="nav-link active" data-scroll-target="#workflow-managers">Workflow managers</a>
  <ul class="collapse">
<li><a href="#a-very-brief-overview-of-a-snakefile" id="toc-a-very-brief-overview-of-a-snakefile" class="nav-link" data-scroll-target="#a-very-brief-overview-of-a-snakefile">A very brief overview of a Snakefile</a></li>
  <li><a href="#a-look-into-the-variant-calling-snakefile" id="toc-a-look-into-the-variant-calling-snakefile" class="nav-link" data-scroll-target="#a-look-into-the-variant-calling-snakefile">A look into the variant calling Snakefile</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../exercises/index.html">Exercises</a></li><li class="breadcrumb-item"><a href="../../exercises/variant_calling/index.html">Variant calling</a></li><li class="breadcrumb-item"><a href="../../exercises/variant_calling/variant_calling_workflow.html">Variant calling workflow</a></li></ol></nav><div class="quarto-title">
<h1 class="title">Variant calling workflow</h1>
</div>

<div>
  <div class="description">
    Perform variant calling and genotyping. Introduction to workflow manager systems.
  </div>
</div>


<div class="quarto-title-meta column-body">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Per Unneberg </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">17-Sep-2025</p>
    </div>
  </div>
  
    
  </div>
  


</header><!-- markdownlint-disable MD041 --><!-- markdownlint-enable MD041 --><!-- markdownlint-disable MD041 --><!-- markdownlint-enable MD041 --><!-- markdownlint-disable MD041 --><!-- markdownlint-enable MD041 --><!-- markdownlint-disable MD041 --><!-- markdownlint-enable MD041 --><div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Intended learning outcomes
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li>Learn how workflow managers can automate complex tasks</li>
<li>Get familiar with the Snakemake manager</li>
</ul>
</div>
</div>
</div>
<!-- markdownlint-disable MD041 -->
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tools
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Listing</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><i class="fa-solid fa-server" aria-label="server"></i> PDC</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false"><i class="fa-solid fa-laptop" aria-label="laptop"></i> pixi</a></li>
</ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<ul>
<li>
<a href="https://samtools.github.io/bcftools/bcftools.html">bcftools</a> <span class="citation" data-cites="danecek_TwelveYearsSAMtools_2021">(<a href="#ref-danecek_TwelveYearsSAMtools_2021" role="doc-biblioref">Danecek et al., 2021</a>)</span>
</li>
<li>
<a href="https://github.com/lh3/bwa">bwa</a> <span class="citation" data-cites="li_AligningSequenceReads_2013">(<a href="#ref-li_AligningSequenceReads_2013" role="doc-biblioref">Li, 2013</a>)</span>
</li>
<li><a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc">fastqc</a></li>
<li>
<a href="https://gatk.broadinstitute.org/hc/en-us">Genome Analysis ToolKit (GATK)</a> <span class="citation" data-cites="depristo_FrameworkVariationDiscovery_2011">(<a href="#ref-depristo_FrameworkVariationDiscovery_2011" role="doc-biblioref">DePristo et al., 2011</a>)</span>
</li>
<li>
<a href="https://multiqc.info/">multiqc</a> <span class="citation" data-cites="ewels_MultiQCSummarizeAnalysis_2016">(<a href="#ref-ewels_MultiQCSummarizeAnalysis_2016" role="doc-biblioref">Ewels et al., 2016</a>)</span>
</li>
<li>
<a href="https://github.com/broadinstitute/picard">picard</a> <span class="citation" data-cites="Picard2019toolkit">(<a href="#ref-Picard2019toolkit" role="doc-biblioref"><span>“Picard Toolkit,”</span> 2019</a>)</span>
</li>
<li>
<a href="http://qualimap.conesalab.org">qualimap</a> <span class="citation" data-cites="okonechnikov_QualimapAdvancedMultisample_2016">(<a href="#ref-okonechnikov_QualimapAdvancedMultisample_2016" role="doc-biblioref">Okonechnikov et al., 2016</a>)</span>
</li>
<li>
<a href="https://github.com/samtools/samtools">samtools</a> <span class="citation" data-cites="danecek_TwelveYearsSAMtools_2021">(<a href="#ref-danecek_TwelveYearsSAMtools_2021" role="doc-biblioref">Danecek et al., 2021</a>)</span>
</li>
<li>
<a href="https://snakemake.readthedocs.io/en/stable/index.html">snakemake</a> <span class="citation" data-cites="molder_SustainableDataAnalysis_2021">(<a href="#ref-molder_SustainableDataAnalysis_2021" role="doc-biblioref">Mölder et al., 2021</a>)</span>
</li>
</ul>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<p>Choose <strong>one</strong> of <strong>Modules</strong> and <strong>Virtual environment</strong> to access relevant tools.</p>
<section id="modules" class="level5"><h5 class="anchored" data-anchor-id="modules">Modules</h5>
<p>Execute the following command to load modules:</p>
<div class="sourceCode">
<pre class="sourceCode bash code-with-copy"><code class="sourceCode bash">module load bioinfo-tools \ 
    bcftools/1.20 bwa/0.7.18 fastqc/0.12.1 \ 
    gatk/4.5.0.0 multiqc/1.30 picard/3.3.0 \ 
    QualiMap/2.2.1 samtools/1.20 snakemake/9.9.0
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
</div>
</section><section id="virtual-environment" class="level5"><h5 class="anchored" data-anchor-id="virtual-environment">Virtual environment</h5>
<p>Run the <code>pgip</code> initialization script and activate the <code>pgip</code> default environment:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">source</span> /cfs/klemming/projects/supr/pgip_2025/init.sh</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Now obsolete!</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pgip_activate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then activate the <code>full</code> environment:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pgip_shell calls pixi shell -e full --as-is</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">pgip_shell</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>Copy the contents to a file <code>pixi.toml</code> in directory <code>variant-calling</code>, <code>cd</code> to directory and activate environment with <code>pixi shell</code>:</p>
<div class="sourceCode cell-code">
<pre class="sourceCode toml code-with-copy"><code class="sourceCode toml">[workspace]
channels = ["conda-forge", "bioconda"]
name = "variant-calling"
platforms = ["linux-64", "osx-64"]

[dependencies]
bcftools = "&gt;=1.22,&lt;2"
bwa = "&gt;=0.7.19,&lt;0.8"
fastqc = "&gt;=0.12.1,&lt;0.13"
gatk4 = "&gt;=4.6.2.0,&lt;5"
multiqc = "&gt;=1.30,&lt;2"
picard = "&gt;=3.4.0,&lt;4"
qualimap = "&gt;=2.3,&lt;3"
samtools = "&gt;=1.22.1,&lt;2"
snakemake = "&gt;=9.9.0,&lt;10"

</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- markdownlint-enable MD041 -->
<!-- markdownlint-disable MD041 -->
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data setup
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist">
<li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><i class="fa-solid fa-server" aria-label="server"></i> PDC</a></li>
<li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><i class="fa-solid fa-laptop" aria-label="laptop"></i> Local</a></li>
</ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<p>Make an analysis directory <code>variant-calling</code> and cd to it:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> variant-calling <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> variant-calling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="using-rsync" class="level5"><h5 class="anchored" data-anchor-id="using-rsync">Using rsync</h5>
<p>Use rsync to sync data to your analysis directory (hint: first use options <code>-anv</code> to run the command without actually copying data):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run rsync -anv first time</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rsync</span> <span class="at">-av</span> /cfs/klemming/projects/supr/pgip_2025/data/monkeyflower/variant-calling/ .</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section><section id="using-pgip-client" class="level5"><h5 class="anchored" data-anchor-id="using-pgip-client">Using pgip client</h5>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">pgip</span> exercises setup e-variant-calling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Make an analysis directory <code>variant-calling</code> and cd to it:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> variant-calling <span class="kw">&amp;&amp;</span> <span class="bu">cd</span> variant-calling</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then use wget to retrieve data to analysis directory.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wget</span> <span class="at">-r</span> <span class="at">-np</span> <span class="at">-nH</span> <span class="at">-N</span> <span class="at">--cut-dirs</span><span class="op">=</span>5 <span class="dt">\</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>     https://export.uppmax.uu.se/uppstore2017171/pgip/data/monkeyflower/variant-calling/</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- markdownlint-enable MD041 -->
<section id="workflow-managers" class="level2"><h2 class="anchored" data-anchor-id="workflow-managers">Workflow managers</h2>
<p>The advent of next-generation sequencing and other high-throughput technologies have contributed to increasing data complexity and data volumes, leading to scalability and reproducibility issues <span class="citation" data-cites="wratten_ReproducibleScalableShareable_2021">(<a href="#ref-wratten_ReproducibleScalableShareable_2021" role="doc-biblioref">Wratten et al., 2021</a>)</span>. A number of workflow managers have beed developed to meet these needs, including <a href="https://snakemake.readthedocs.io/en/stable/">Snakemake</a> <span class="citation" data-cites="molder_SustainableDataAnalysis_2021">(<a href="#ref-molder_SustainableDataAnalysis_2021" role="doc-biblioref">Mölder et al., 2021</a>)</span> and <a href="https://www.nextflow.io/">Nextflow</a> <span class="citation" data-cites="ditommaso_NextflowEnablesReproducible_2017">(<a href="#ref-ditommaso_NextflowEnablesReproducible_2017" role="doc-biblioref">Di Tommaso et al., 2017</a>)</span>.</p>
<p>In this exercise, we will use Snakemake to run a variant calling workflow from start to end. We urge the reader to briefly skim the Snakefile<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, the Snakemake command file. We will briefly describe how Snakemake works in the next section, but going into any details is out of the scope of this exercise. See the <a href="https://snakemake.readthedocs.io/en/stable/">Snakemake documentation</a> for more information, and if you want to learn more, there are NBIS courses on <a href="https://nbis.se/training/tools-for-reproducible-research">reproducible research</a> and <a href="https://nbis.se/training/snakemake-byoc-bring-your-own-code-workshop">Snakemake</a>.</p>
<section id="a-very-brief-overview-of-a-snakefile" class="level3"><h3 class="anchored" data-anchor-id="a-very-brief-overview-of-a-snakefile">A very brief overview of a Snakefile</h3>
<p>A Snakemake workflow consists of rules that determine how inputs are connected to outputs. Rules are defined in a so-called <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html">Snakefile</a>. Below is an example of a bare minimum rule:</p>
<pre class="text"><code>rule samtools_index:
    output:
        "ref/M_aurantiacus_v1.fasta.fai"
    input:
        "ref/M_aurantiacus_v1.fasta"
    shell:
        "samtools faidx {input} -o {output}"</code></pre>
<p>The rule consists of a <strong>name</strong> (<code>samtools_faidx</code>) and <strong>keywords</strong> (<code>output</code>, <code>input</code>, <code>shell</code>). The <code>shell</code> keyword defines a shell command to be run (<code>samtools faidx</code>), which will take the <code>input</code> (<code>ref/M_aurantiacus_v1.fasta</code>) and produce an <code>output</code> (<code>ref/M_aurantiacus_v1.fasta.fai</code>). Note here the curly brackets; these are <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#wildcards">Snakemake wildcards</a> which makes it possible to generalize rules to match file name patterns.</p>
<p>Provided the input file exists, running <code>snakemake</code> would produce the output, unless the output already exists. This is one neat feature of workflow managers - they are designed to detect whether input files are newer than output files, and only then will they forcefully regenerate the output<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>.</p>
<div class="callout callout-style-default callout-exercise callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="callout-exercise">
<p>Copy the <code>samtools_index</code> rule to a file called <code>Snakefile</code> and run <code>snakemake --dry-run --printshellcmds --force</code> (alternatively <code>snakemake -n -p</code>). What happens?</p>
<div class="callout callout-style-default callout-answer callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="callout-answer">
<p>Snakemake will output what jobs it will run, the reason, and which shell command.</p>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<p>A workflow is built by connecting outputs from one rule to inputs of another. A rule can depend on multiple inputs, as well as produce multiple outputs.</p>
<div class="callout callout-style-default callout-exercise callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="callout-exercise">
<p>In the above Snakefile, add a rule <code>count_lines</code> that uses the input <code>ref/M_aurantiacus_v1.fasta.fai</code> to generate the output file <code>wc.txt</code>, and where the shell command is uses <code>wc -l</code> to count lines in the input and redirect (<code>&gt;</code>) to output. Then run the command <code>snakemake wc.txt</code> and look at the contents of the file.</p>
<div class="callout callout-style-default callout-answer callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Answer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="callout-answer">
<pre><code>rule samtools_index:
    output:
        "ref/M_aurantiacus_v1.fasta.fai"
    input:
        "ref/M_aurantiacus_v1.fasta"
    shell:
        "samtools faidx {input} -o {output}"

rule count_lines:
    output: "wc.txt"
    input: "ref/M_aurantiacus_v1.fasta.fai"
    shell: "wc -l {input} &gt; {output}"</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make sure to remove the Snakefile before proceeding as it otherwise will take precedence over the <code>workflow/Snakefile</code>.</p>
</div>
</div>
</section><section id="a-look-into-the-variant-calling-snakefile" class="level3"><h3 class="anchored">A look into the variant calling Snakefile</h3>
<p>Open <code>workflow/Snakefile</code> and look briefly at the contents. The top portion contains code to read the sampleinfo file and defines a variable <code>REFERENCE</code> that can be used throughout<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a><span class="co"># Read sampleinfo and subset to</span></span>
<span id="cb10-4"><a href="#cb10-4"></a>sampleinfo <span class="op">=</span> pd.read_csv(<span class="st">"sampleinfo.csv"</span>)</span>
<span id="cb10-5"><a href="#cb10-5"></a>sampleinfo <span class="op">=</span> sampleinfo.loc[sampleinfo.SampleAlias.<span class="bu">str</span>.startswith(<span class="st">"PUN"</span>)]<span class="op">\</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>                       .set_index(<span class="st">"SampleAlias"</span>)</span>
<span id="cb10-7"><a href="#cb10-7"></a>samples <span class="op">=</span> sampleinfo.index.values</span>
<span id="cb10-8"><a href="#cb10-8"></a></span>
<span id="cb10-9"><a href="#cb10-9"></a>REFERENCE <span class="op">=</span> <span class="st">"ref/M_aurantiacus_v1.fasta"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>By default, Snakemake runs the argument if no filename is provided when running. By convention, the first rule is called <code>all</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>rule <span class="bu">all</span>:</span>
<span id="cb11-2"><a href="#cb11-2"></a>    <span class="bu">input</span>: <span class="st">"multiqc_report.html"</span>,</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is a so-called <a href="https://snakemake.readthedocs.io/en/stable/snakefiles/rules.html#target-rules">pseudo-rule</a> which are used to list the final desired output file. The workflow will figure out how to generate necessary inputs.</p>
<p>The remainder of the file contain the “regular” rule definitions. They have been kept as simple as possible, but you will notice that we have made use of some additional code constructs not mentioned above. Skim the file, and look at the <code>multiqc</code> rule at the bottom. Notice how it is used to “collect” necessary inputs which all have to be generated before the report is written.</p>
<p>It can be difficult to get an overview of the workflow by simply looking at the Snakefile. Therefore, we end by showing a rulegraph of the workflow, which shows how rules are connected:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--rulegraph</span> <span class="kw">|</span> <span class="ex">dot</span> <span class="at">-Tpng</span> <span class="kw">|</span> <span class="ex">display</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<!--?xml version="1.0" encoding="UTF-8" standalone="no"?--><!-- Generated by graphviz version 12.2.1 (20250203.1708)
 --><!-- Title: snakemake_dag Pages: 1 --><svg width="606pt" height="836pt" viewbox="0.00 0.00 606.00 836.00" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 832)"><title>
snakemake_dag
</title>
<polygon fill="white" stroke="none" points="-4,4 -4,-832 602,-832 602,4 -4,4"></polygon><!-- 0 --><g id="node1" class="node"><title>
0
</title>
<path fill="none" stroke="#d85656" stroke-width="2" d="M231,-36C231,-36 201,-36 201,-36 195,-36 189,-30 189,-24 189,-24 189,-12 189,-12 189,-6 195,0 201,0 201,0 231,0 231,0 237,0 243,-6 243,-12 243,-12 243,-24 243,-24 243,-30 237,-36 231,-36"></path><text text-anchor="middle" x="216" y="-14.88" font-family="sans" font-size="10.00">all</text></g><!-- 1 --><g id="node2" class="node"><title>
1
</title>
<path fill="none" stroke="#56d8b9" stroke-width="2" d="M231,-108C231,-108 201,-108 201,-108 195,-108 189,-102 189,-96 189,-96 189,-84 189,-84 189,-78 195,-72 201,-72 201,-72 231,-72 231,-72 237,-72 243,-78 243,-84 243,-84 243,-96 243,-96 243,-102 237,-108 231,-108"></path><text text-anchor="middle" x="216" y="-86.88" font-family="sans" font-size="10.00">multiqc</text></g><!-- 1&#45;&gt;0 --><g id="edge1" class="edge"><title>
1-&gt;0
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M216,-71.34C216,-64.75 216,-57.08 216,-49.67"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="219.5,-49.93 216,-39.93 212.5,-49.93 219.5,-49.93"></polygon></g><!-- 2 --><g id="node3" class="node"><title>
2
</title>
<path fill="none" stroke="#d6d856" stroke-width="2" d="M42,-180C42,-180 12,-180 12,-180 6,-180 0,-174 0,-168 0,-168 0,-156 0,-156 0,-150 6,-144 12,-144 12,-144 42,-144 42,-144 48,-144 54,-150 54,-156 54,-156 54,-168 54,-168 54,-174 48,-180 42,-180"></path><text text-anchor="middle" x="27" y="-158.88" font-family="sans" font-size="10.00">fastqc</text></g><!-- 2&#45;&gt;1 --><g id="edge4" class="edge"><title>
2-&gt;1
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M54.71,-149.29C59.14,-147.48 63.69,-145.67 68,-144 104.31,-129.98 146.1,-115.13 175.99,-104.73"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="176.86,-108.13 185.17,-101.55 174.57,-101.52 176.86,-108.13"></polygon></g><!-- 3 --><g id="node4" class="node"><title>
3
</title>
<path fill="none" stroke="#d87556" stroke-width="2" d="M312.75,-180C312.75,-180 253.25,-180 253.25,-180 247.25,-180 241.25,-174 241.25,-168 241.25,-168 241.25,-156 241.25,-156 241.25,-150 247.25,-144 253.25,-144 253.25,-144 312.75,-144 312.75,-144 318.75,-144 324.75,-150 324.75,-156 324.75,-156 324.75,-168 324.75,-168 324.75,-174 318.75,-180 312.75,-180"></path><text text-anchor="middle" x="283" y="-158.88" font-family="sans" font-size="10.00">bcftools_stats</text></g><!-- 3&#45;&gt;1 --><g id="edge3" class="edge"><title>
3-&gt;1
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M266.09,-143.34C258.77,-135.69 250.03,-126.56 241.92,-118.08"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="244.67,-115.89 235.23,-111.09 239.61,-120.73 244.67,-115.89"></polygon></g><!-- 4 --><g id="node5" class="node"><title>
4
</title>
<path fill="none" stroke="#59d856" stroke-width="2" d="M398.12,-252C398.12,-252 301.88,-252 301.88,-252 295.88,-252 289.88,-246 289.88,-240 289.88,-240 289.88,-228 289.88,-228 289.88,-222 295.88,-216 301.88,-216 301.88,-216 398.12,-216 398.12,-216 404.12,-216 410.12,-222 410.12,-228 410.12,-228 410.12,-240 410.12,-240 410.12,-246 404.12,-252 398.12,-252"></path><text text-anchor="middle" x="350" y="-230.88" font-family="sans" font-size="10.00">gatk_genotype_gvcfs</text></g><!-- 4&#45;&gt;3 --><g id="edge6" class="edge"><title>
4-&gt;3
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M333.09,-215.34C325.77,-207.69 317.03,-198.56 308.92,-190.08"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="311.67,-187.89 302.23,-183.09 306.61,-192.73 311.67,-187.89"></polygon></g><!-- 5 --><g id="node6" class="node"><title>
5
</title>
<path fill="none" stroke="#78d856" stroke-width="2" d="M346.25,-324C346.25,-324 253.75,-324 253.75,-324 247.75,-324 241.75,-318 241.75,-312 241.75,-312 241.75,-300 241.75,-300 241.75,-294 247.75,-288 253.75,-288 253.75,-288 346.25,-288 346.25,-288 352.25,-288 358.25,-294 358.25,-300 358.25,-300 358.25,-312 358.25,-312 358.25,-318 352.25,-324 346.25,-324"></path><text text-anchor="middle" x="300" y="-302.88" font-family="sans" font-size="10.00">gatk_combine_gvcfs</text></g><!-- 5&#45;&gt;4 --><g id="edge9" class="edge"><title>
5-&gt;4
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M312.62,-287.34C317.79,-280.1 323.91,-271.53 329.68,-263.45"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="332.49,-265.54 335.45,-255.37 326.79,-261.47 332.49,-265.54"></polygon></g><!-- 6 --><g id="node7" class="node"><title>
6
</title>
<path fill="none" stroke="#56d87b" stroke-width="2" d="M353.5,-396C353.5,-396 232.5,-396 232.5,-396 226.5,-396 220.5,-390 220.5,-384 220.5,-384 220.5,-372 220.5,-372 220.5,-366 226.5,-360 232.5,-360 232.5,-360 353.5,-360 353.5,-360 359.5,-360 365.5,-366 365.5,-372 365.5,-372 365.5,-384 365.5,-384 365.5,-390 359.5,-396 353.5,-396"></path><text text-anchor="middle" x="293" y="-374.88" font-family="sans" font-size="10.00">gatk_haplotypecaller_bqsr</text></g><!-- 6&#45;&gt;5 --><g id="edge10" class="edge"><title>
6-&gt;5
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M294.77,-359.34C295.42,-352.75 296.19,-345.08 296.93,-337.67"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="300.4,-338.21 297.91,-327.91 293.43,-337.52 300.4,-338.21"></polygon></g><!-- 7 --><g id="node8" class="node"><title>
7
</title>
<path fill="none" stroke="#b6d856" stroke-width="2" d="M271.12,-468C271.12,-468 198.88,-468 198.88,-468 192.88,-468 186.88,-462 186.88,-456 186.88,-456 186.88,-444 186.88,-444 186.88,-438 192.88,-432 198.88,-432 198.88,-432 271.12,-432 271.12,-432 277.12,-432 283.12,-438 283.12,-444 283.12,-444 283.12,-456 283.12,-456 283.12,-462 277.12,-468 271.12,-468"></path><text text-anchor="middle" x="235" y="-446.88" font-family="sans" font-size="10.00">gatk_apply_bqsr</text></g><!-- 7&#45;&gt;6 --><g id="edge13" class="edge"><title>
7-&gt;6
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M249.64,-431.34C255.77,-423.93 263.05,-415.14 269.88,-406.9"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="272.55,-409.17 276.24,-399.23 267.16,-404.7 272.55,-409.17"></polygon></g><!-- 8 --><g id="node9" class="node"><title>
8
</title>
<path fill="none" stroke="#56b9d8" stroke-width="2" d="M189.12,-684C189.12,-684 80.88,-684 80.88,-684 74.88,-684 68.88,-678 68.88,-672 68.88,-672 68.88,-660 68.88,-660 68.88,-654 74.88,-648 80.88,-648 80.88,-648 189.12,-648 189.12,-648 195.12,-648 201.12,-654 201.12,-660 201.12,-660 201.12,-672 201.12,-672 201.12,-678 195.12,-684 189.12,-684"></path><text text-anchor="middle" x="135" y="-662.88" font-family="sans" font-size="10.00">picard_mark_duplicates</text></g><!-- 8&#45;&gt;1 --><g id="edge5" class="edge"><title>
8-&gt;1
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M123.76,-647.41C108.2,-621.33 82,-570.37 82,-523 82,-523 82,-523 82,-233 82,-177.16 137.49,-134.38 177.05,-110.98"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="178.64,-114.11 185.6,-106.12 175.18,-108.02 178.64,-114.11"></polygon></g><!-- 8&#45;&gt;7 --><g id="edge15" class="edge"><title>
8-&gt;7
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M133.78,-647.05C132.52,-615.59 133.8,-549.54 162,-504 168.8,-493.02 178.8,-483.61 189.23,-475.9"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="190.91,-478.99 197.2,-470.47 186.97,-473.21 190.91,-478.99"></polygon></g><!-- 11 --><g id="node12" class="node"><title>
11
</title>
<path fill="none" stroke="#97d856" stroke-width="2" d="M286.88,-540C286.88,-540 183.12,-540 183.12,-540 177.12,-540 171.12,-534 171.12,-528 171.12,-528 171.12,-516 171.12,-516 171.12,-510 177.12,-504 183.12,-504 183.12,-504 286.88,-504 286.88,-504 292.88,-504 298.88,-510 298.88,-516 298.88,-516 298.88,-528 298.88,-528 298.88,-534 292.88,-540 286.88,-540"></path><text text-anchor="middle" x="235" y="-518.88" font-family="sans" font-size="10.00">gatk_base_recalibrator</text></g><!-- 8&#45;&gt;11 --><g id="edge19" class="edge"><title>
8-&gt;11
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M141.06,-647.17C147.96,-628.36 160.47,-598.41 177,-576 184.06,-566.43 193.04,-557.23 201.81,-549.26"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="203.98,-552.02 209.23,-542.81 199.38,-546.73 203.98,-552.02"></polygon></g><!-- 12 --><g id="node13" class="node"><title>
12
</title>
<path fill="none" stroke="#56d89a" stroke-width="2" d="M316,-612C316,-612 198,-612 198,-612 192,-612 186,-606 186,-600 186,-600 186,-588 186,-588 186,-582 192,-576 198,-576 198,-576 316,-576 316,-576 322,-576 328,-582 328,-588 328,-588 328,-600 328,-600 328,-606 322,-612 316,-612"></path><text text-anchor="middle" x="257" y="-590.88" font-family="sans" font-size="10.00">gatk_haplotypecaller_raw</text></g><!-- 8&#45;&gt;12 --><g id="edge22" class="edge"><title>
8-&gt;12
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M166.1,-647.15C180.87,-638.68 198.75,-628.42 214.73,-619.25"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="216.4,-622.33 223.33,-614.32 212.91,-616.26 216.4,-622.33"></polygon></g><!-- 9 --><g id="node10" class="node"><title>
9
</title>
<path fill="none" stroke="#d8b456" stroke-width="2" d="M360.5,-756C360.5,-756 317.5,-756 317.5,-756 311.5,-756 305.5,-750 305.5,-744 305.5,-744 305.5,-732 305.5,-732 305.5,-726 311.5,-720 317.5,-720 317.5,-720 360.5,-720 360.5,-720 366.5,-720 372.5,-726 372.5,-732 372.5,-732 372.5,-744 372.5,-744 372.5,-750 366.5,-756 360.5,-756"></path><text text-anchor="middle" x="339" y="-734.88" font-family="sans" font-size="10.00">bwa_mem</text></g><!-- 9&#45;&gt;8 --><g id="edge16" class="edge"><title>
9-&gt;8
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M304.85,-725.28C276.14,-715.43 234.3,-701.07 199.33,-689.07"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="200.74,-685.86 190.14,-685.92 198.46,-692.48 200.74,-685.86"></polygon></g><!-- 15 --><g id="node16" class="node"><title>
15
</title>
<path fill="none" stroke="#569ad8" stroke-width="2" d="M586,-612C586,-612 510,-612 510,-612 504,-612 498,-606 498,-600 498,-600 498,-588 498,-588 498,-582 504,-576 510,-576 510,-576 586,-576 586,-576 592,-576 598,-582 598,-588 598,-588 598,-600 598,-600 598,-606 592,-612 586,-612"></path><text text-anchor="middle" x="548" y="-590.88" font-family="sans" font-size="10.00">qualimap_bamqc</text></g><!-- 9&#45;&gt;15 --><g id="edge23" class="edge"><title>
9-&gt;15
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M373.27,-736.96C414.98,-735 484.79,-725.22 525,-684 539.98,-668.65 545.57,-644.89 547.5,-625.78"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="550.99,-626.1 548.14,-615.9 544,-625.65 550.99,-626.1"></polygon></g><!-- 10 --><g id="node11" class="node"><title>
10
</title>
<path fill="none" stroke="#d89556" stroke-width="2" d="M361.25,-828C361.25,-828 316.75,-828 316.75,-828 310.75,-828 304.75,-822 304.75,-816 304.75,-816 304.75,-804 304.75,-804 304.75,-798 310.75,-792 316.75,-792 316.75,-792 361.25,-792 361.25,-792 367.25,-792 373.25,-798 373.25,-804 373.25,-804 373.25,-816 373.25,-816 373.25,-822 367.25,-828 361.25,-828"></path><text text-anchor="middle" x="339" y="-806.88" font-family="sans" font-size="10.00">bwa_index</text></g><!-- 10&#45;&gt;9 --><g id="edge17" class="edge"><title>
10-&gt;9
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M339,-791.34C339,-784.75 339,-777.08 339,-769.67"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="342.5,-769.93 339,-759.93 335.5,-769.93 342.5,-769.93"></polygon></g><!-- 11&#45;&gt;7 --><g id="edge14" class="edge"><title>
11-&gt;7
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M235,-503.34C235,-496.75 235,-489.08 235,-481.67"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="238.5,-481.93 235,-471.93 231.5,-481.93 238.5,-481.93"></polygon></g><!-- 12&#45;&gt;11 --><g id="edge18" class="edge"><title>
12-&gt;11
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M251.45,-575.34C249.33,-568.59 246.85,-560.69 244.46,-553.11"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="247.87,-552.28 241.53,-543.79 241.19,-554.38 247.87,-552.28"></polygon></g><!-- 13 --><g id="node14" class="node"><title>
13
</title>
<path fill="none" stroke="#56d8d8" stroke-width="2" d="M394.88,-684C394.88,-684 231.12,-684 231.12,-684 225.12,-684 219.12,-678 219.12,-672 219.12,-672 219.12,-660 219.12,-660 219.12,-654 225.12,-648 231.12,-648 231.12,-648 394.88,-648 394.88,-648 400.88,-648 406.88,-654 406.88,-660 406.88,-660 406.88,-672 406.88,-672 406.88,-678 400.88,-684 394.88,-684"></path><text text-anchor="middle" x="313" y="-662.88" font-family="sans" font-size="10.00">picard_create_sequence_dictionary</text></g><!-- 13&#45;&gt;4 --><g id="edge8" class="edge"><title>
13-&gt;4
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M331.38,-647.13C355.28,-621.89 394,-573.24 394,-523 394,-523 394,-523 394,-377 394,-336.71 377.64,-292.76 364.87,-264.59"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="368.05,-263.12 360.62,-255.57 361.72,-266.11 368.05,-263.12"></polygon></g><!-- 13&#45;&gt;6 --><g id="edge12" class="edge"><title>
13-&gt;6
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M323.45,-647.02C328.64,-637.06 334.36,-624.24 337,-612 352.69,-539.3 324.32,-453.17 306.27,-408.77"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="309.55,-407.55 302.45,-399.69 303.1,-410.26 309.55,-407.55"></polygon></g><!-- 13&#45;&gt;12 --><g id="edge21" class="edge"><title>
13-&gt;12
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M298.87,-647.34C292.95,-639.93 285.91,-631.14 279.32,-622.9"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="282.19,-620.89 273.21,-615.27 276.73,-625.26 282.19,-620.89"></polygon></g><!-- 14 --><g id="node15" class="node"><title>
14
</title>
<path fill="none" stroke="#567bd8" stroke-width="2" d="M503.5,-684C503.5,-684 436.5,-684 436.5,-684 430.5,-684 424.5,-678 424.5,-672 424.5,-672 424.5,-660 424.5,-660 424.5,-654 430.5,-648 436.5,-648 436.5,-648 503.5,-648 503.5,-648 509.5,-648 515.5,-654 515.5,-660 515.5,-660 515.5,-672 515.5,-672 515.5,-678 509.5,-684 503.5,-684"></path><text text-anchor="middle" x="470" y="-662.88" font-family="sans" font-size="10.00">samtools_faidx</text></g><!-- 14&#45;&gt;4 --><g id="edge7" class="edge"><title>
14-&gt;4
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M470,-647.07C470,-620.13 470,-567.62 470,-523 470,-523 470,-523 470,-377 470,-326.69 425.51,-285 390.71,-260.09"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="392.99,-257.41 382.77,-254.62 389.02,-263.17 392.99,-257.41"></polygon></g><!-- 14&#45;&gt;6 --><g id="edge11" class="edge"><title>
14-&gt;6
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M460.84,-647.23C440.15,-607.53 387.48,-509.1 335,-432 329.21,-423.5 322.47,-414.61 316.1,-406.59"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="318.97,-404.58 309.96,-399.01 313.53,-408.99 318.97,-404.58"></polygon></g><!-- 14&#45;&gt;12 --><g id="edge20" class="edge"><title>
14-&gt;12
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M423.52,-649.72C394.32,-640.13 356.19,-627.6 323.78,-616.95"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="325.14,-613.71 314.55,-613.91 322.95,-620.36 325.14,-613.71"></polygon></g><!-- 15&#45;&gt;1 --><g id="edge2" class="edge"><title>
15-&gt;1
</title>
<path fill="none" stroke="grey" stroke-width="2" d="M543.86,-575.18C538,-548.39 528,-496.06 528,-451 528,-451 528,-451 528,-233 528,-115.2 341.46,-94.67 256.86,-91.42"></path><polygon fill="grey" stroke="grey" stroke-width="2" points="257.09,-87.93 246.99,-91.12 256.88,-94.92 257.09,-87.93"></polygon></g></g></svg><p>:::</p>
<section id="running-the-workflow" class="level2"><h2 class="anchored" data-anchor-id="running-the-workflow">Running the workflow</h2>
<p>Now we turn to actually running the workflow. First use the options <code>snakemake -n -p</code> to check what the actual command flow looks like<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>. If everything looks ok, launch Snakemake, adding the <code>--cores</code> option to run jobs in parallel:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="ex">snakemake</span> <span class="at">--cores</span> 10</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That’s all there is to it! Now you can take a break / listen to the next lecture while the workflow (hopefully) runs to completion without interruptions.</p>
<div class="callout callout-style-default callout-exercise callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Exercise
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div>
<div class="callout-exercise">
<p>Once the workflow has finished, open and have a look at <code>multiqc_report.html</code>. Also check the output variant files in directory <code>gatk-genotype-gvcfs</code>.</p>
</div>
</div>
</div>
</div>
</div>


</section>
</div>

</section></section><div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" data-line-spacing="2" role="list">
<div id="ref-danecek_TwelveYearsSAMtools_2021" class="csl-entry" role="listitem">
Danecek, P., Bonfield, J. K., Liddle, J., Marshall, J., Ohan, V., Pollard, M. O., Whitwham, A., Keane, T., McCarthy, S. A., Davies, R. M., &amp; Li, H. (2021). Twelve years of <span>SAMtools</span> and <span>BCFtools</span>. <em>GigaScience</em>, <em>10</em>(2), giab008. <a href="https://doi.org/10.1093/gigascience/giab008">https://doi.org/10.1093/gigascience/giab008</a>
</div>
<div id="ref-depristo_FrameworkVariationDiscovery_2011" class="csl-entry" role="listitem">
DePristo, M. A., Banks, E., Poplin, R., Garimella, K. V., Maguire, J. R., Hartl, C., Philippakis, A. A., del Angel, G., Rivas, M. A., Hanna, M., McKenna, A., Fennell, T. J., Kernytsky, A. M., Sivachenko, A. Y., Cibulskis, K., Gabriel, S. B., Altshuler, D., &amp; Daly, M. J. (2011). A framework for variation discovery and genotyping using next-generation <span>DNA</span> sequencing data. <em>Nature Genetics</em>, <em>43</em>(5), 491–498. <a href="https://doi.org/10.1038/ng.806">https://doi.org/10.1038/ng.806</a>
</div>
<div id="ref-ditommaso_NextflowEnablesReproducible_2017" class="csl-entry" role="listitem">
Di Tommaso, P., Chatzou, M., Floden, E. W., Barja, P. P., Palumbo, E., &amp; Notredame, C. (2017). Nextflow enables reproducible computational workflows. <em>Nature Biotechnology</em>, <em>35</em>(4), 316–319. <a href="https://doi.org/10.1038/nbt.3820">https://doi.org/10.1038/nbt.3820</a>
</div>
<div id="ref-ewels_MultiQCSummarizeAnalysis_2016" class="csl-entry" role="listitem">
Ewels, P., Magnusson, M., Lundin, S., &amp; Käller, M. (2016). <span>MultiQC</span>: Summarize analysis results for multiple tools and samples in a single report. <em>Bioinformatics</em>, <em>32</em>(19), 3047–3048. <a href="https://doi.org/10.1093/bioinformatics/btw354">https://doi.org/10.1093/bioinformatics/btw354</a>
</div>
<div id="ref-li_AligningSequenceReads_2013" class="csl-entry" role="listitem">
Li, H. (2013). Aligning sequence reads, clone sequences and assembly contigs with <span>BWA-MEM</span>. <em>arXiv:1303.3997 [q-Bio]</em>. <a href="https://arxiv.org/abs/1303.3997">https://arxiv.org/abs/1303.3997</a>
</div>
<div id="ref-molder_SustainableDataAnalysis_2021" class="csl-entry" role="listitem">
Mölder, F., Jablonski, K. P., Letcher, B., Hall, M. B., Tomkins-Tinch, C. H., Sochat, V., Forster, J., Lee, S., Twardziok, S. O., Kanitz, A., Wilm, A., Holtgrewe, M., Rahmann, S., Nahnsen, S., &amp; Köster, J. (2021). <em>Sustainable data analysis with <span>Snakemake</span></em> (10:33). F1000Research. <a href="https://doi.org/10.12688/f1000research.29032.2">https://doi.org/10.12688/f1000research.29032.2</a>
</div>
<div id="ref-okonechnikov_QualimapAdvancedMultisample_2016" class="csl-entry" role="listitem">
Okonechnikov, K., Conesa, A., &amp; García-Alcalde, F. (2016). Qualimap 2: Advanced multi-sample quality control for high-throughput sequencing data. <em>Bioinformatics</em>, <em>32</em>(2), 292–294. <a href="https://doi.org/10.1093/bioinformatics/btv566">https://doi.org/10.1093/bioinformatics/btv566</a>
</div>
<div id="ref-Picard2019toolkit" class="csl-entry" role="listitem">
Picard toolkit. (2019). In <em>Broad Institute, GitHub repository</em>. <a href="https://broadinstitute.github.io/picard/" class="uri">https://broadinstitute.github.io/picard/</a>; Broad Institute.
</div>
<div id="ref-wratten_ReproducibleScalableShareable_2021" class="csl-entry" role="listitem">
Wratten, L., Wilm, A., &amp; Göke, J. (2021). Reproducible, scalable, and shareable analysis pipelines with bioinformatics workflow managers. <em>Nature Methods</em>, <em>18</em>(10), 1161–1168. <a href="https://doi.org/10.1038/s41592-021-01254-9">https://doi.org/10.1038/s41592-021-01254-9</a>
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>
<ol>
<li id="fn1"><p>Snakemake borrows much of its terminology and philosophy from <a href="https://en.wikipedia.org/wiki/Make_(software)">Make</a>, which was originally designed to automate software builds.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>You can also provide the <code>--force</code> flag to regenerate an output, regardless of whether the input file is younger or not.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Snakemake is written in Python. If you’re familiar with Python, you will recognize much of the syntax.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>You can also add the flag <code>--forceall/-F</code> to trigger a rerun of <strong>all</strong> outputs.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol></section></div></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/NBISweden\.github\.io\/workshop-pgip-H25\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>2025 <a href="https://nbis.se">NBIS</a> | <a href="https://choosealicense.com/licenses/gpl-3.0/">GPL-3 License</a></p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
<p>Published with <a href="https://quarto.org/">Quarto</a> v<!--?quarto.version ?--></p>
</div>
  </div>
</footer>


</body></html>